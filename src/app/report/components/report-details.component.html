@if (loading) {
  <section class="loading">
    <mat-spinner diameter="64"></mat-spinner>
  </section>
}

@if (!loading && !!analysis) {
  <section class="content">
    <form class="target-form" [formGroup]="form">
      <mat-form-field class="fill" appearance="outline">
        <mat-label>Filter by Target</mat-label>
        <mat-select formControlName="target" (selectionChange)="onTargetChange($event)">
          <mat-option [value]="0">All Targets</mat-option>
          @for (option of targets; track option.id) {
            <mat-option [value]="option.id">
              {{option.name}}
            </mat-option>
          }
        </mat-select>
      </mat-form-field>
    </form>

    @if (showDownrankWarning) {
      <mat-card class="downranked">
        <mat-card-content>
          <h4 class="text-warning">Detected Downranked Spells:</h4>
          <ul>
            @for (spell of downranked; track spell.name) {
              <li>
                {{spell.name}} (Rank {{spell.rank}} of {{spell.max}})
              </li>
            }
          </ul>
        </mat-card-content>
      </mat-card>
    }

    <mat-tab-group [selectedIndex]="activeTab" (selectedTabChange)="onTabChange($event)">
      @for (tab of tabs; track tab.label) {
        <mat-tab>
          <ng-template mat-tab-label>
            @if (tab.icon) {
              <span class="icon spell-{{ tab.icon }}"></span>
            }
            <span [ngClass]="{ 'label': tab.icon }">{{ tab.label }}</span>
          </ng-template>
          <summary [fields]="tab.stats"></summary>
          <casts
            [analysis]="analysis"
            [spellId]="tab.spellId"
            [highlight]="highlight"
            [casts]="tab.casts"
            [hitCounts]="tab.hitCounts">
          </casts>
        </mat-tab>
      }
    </mat-tab-group>
  </section>
}
